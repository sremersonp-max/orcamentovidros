<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OrÃ§amentista VidraÃ§aria da Familia â€” Com Banco de Dados</title>
    
    <!-- Incluir Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Modal de Login Administrativo -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ” Acesso Administrativo</h2>
                <button class="close-modal" onclick="closeLoginModal()">Ã—</button>
            </div>
            
            <div id="loginForm">
                <p class="muted">Acesso para visualizar todos os orÃ§amentos do banco de dados</p>
                
                <label>Email</label>
                <input type="email" id="loginEmail" placeholder="seu@email.com">
                
                <label>Senha</label>
                <input type="password" id="loginPassword" placeholder="Sua senha">
                
                <div class="error" id="loginError"></div>
                
                <div class="actions" style="margin-top:15px">
                    <button class="btn" onclick="login()">Entrar</button>
                    <button class="ghost" onclick="closeLoginModal()">Cancelar</button>
                </div>
            </div>
            
            <div id="adminPanel" style="display:none">
                <div class="modal-header">
                    <h2>ğŸ“Š Painel Administrativo</h2>
                    <button class="close-modal" onclick="closeLoginModal()">Ã—</button>
                </div>
                
                <div class="actions">
                    <button class="btn" onclick="viewAllBudgets()">ğŸ”„ Atualizar Lista</button>
                    <button class="ghost" onclick="logout()">ğŸšª Sair</button>
                </div>
                
                <div id="allBudgetsList" style="margin-top:15px; max-height:60vh; overflow:auto">
                    <div class="loading">Clique em "Atualizar Lista" para carregar os orÃ§amentos...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="wrap">
        <header class="card">
            <div style="display:flex;justify-content:space-between;align-items:center">
                <h1>ğŸ  VidraÃ§aria da FamÃ­lia - Sistema de OrÃ§amentos</h1>
                <button class="btn small" onclick="openLoginModal()">ğŸ‘¤ Admin</button>
            </div>
            <div class="muted">
                ğŸ’¡ Selecione produtos, configure medidas e adicione itens. Clique em "Ver OrÃ§amento" para gerar o PDF.
                <span id="connectionStatus" style="margin-left:10px; padding:2px 8px; border-radius:4px; background:#dcfce7; color:#166534; font-size:0.8rem;">
                    âœ… Conectado ao Banco de Dados
                </span>
            </div>
        </header>

        <main class="grid">
            <!-- FormulÃ¡rio Principal -->
            <section class="card" id="formCard">
                <h2 style="margin:0 0 10px 0; color:var(--accent);">ğŸ“ Novo OrÃ§amento</h2>

                <div style="background:#f0f9ff; padding:12px; border-radius:8px; margin-bottom:15px;">
                    <h3 style="margin:0 0 8px 0; color:#0369a1;">ğŸ‘¤ Dados do Cliente</h3>
                    
                    <label>Nome do Cliente <span class="required">*</span></label>
                    <input id="cliente" placeholder="Ex: JoÃ£o da Silva" required>
                    <div class="error" id="clienteError"></div>

                    <label>Telefone <span class="required">*</span></label>
                    <input id="telefone" placeholder="(11) 99999-9999" required>
                    <div class="error" id="telefoneError"></div>
                </div>

                <hr style="margin:12px 0;border:none;border-top:1px solid #eef2f6">

                <h3 style="margin:0 0 10px 0; color:var(--accent);">ğŸ›ï¸ Itens do OrÃ§amento</h3>

                <label>Categoria</label>
                <select id="category">
                    <option value="">â€” Selecione a Categoria â€”</option>
                    <option value="1">ğŸªŸ Janela</option>
                    <option value="2">ğŸšª Porta</option>
                    <option value="5">ğŸª Espelho</option>
                    <option value="6">ğŸš¿ Box Banheiro</option>
                    <option value="7">ğŸ¢ Painel/Vitrine</option>
                    <option value="8">ğŸ¦Ÿ Tela Mosquiteiro</option>
                </select>

                <div id="dynamicFields" style="margin-top:10px; min-height:60px;">
                    <div class="muted">Escolha uma categoria para ver as opÃ§Ãµes especÃ­ficas...</div>
                </div>

                <div class="item-row" style="margin-top:10px">
                    <div>
                        <label>ğŸ“ Largura (m)</label>
                        <input id="width" type="number" step="0.01" min="0" placeholder="Ex: 1.20">
                    </div>
                    <div>
                        <label>ğŸ“ Altura (m)</label>
                        <input id="height" type="number" step="0.01" min="0" placeholder="Ex: 1.00">
                    </div>
                    <div>
                        <label>ğŸ”¢ Quantidade</label>
                        <input id="qty" type="number" min="1" step="1" value="1">
                    </div>
                </div>

                <div style="margin-top:12px; display:flex; justify-content:space-between; align-items:center; gap:12px">
                    <div class="muted">ğŸ’° O valor serÃ¡ calculado no PDF</div>
                    <div style="display:flex;gap:8px">
                        <button class="btn" id="addItemBtn" disabled>â• Adicionar Item</button>
                        <button class="ghost" id="resetFormBtn">ğŸ”„ Limpar</button>
                    </div>
                </div>

                <div class="note">
                    ğŸ“ <strong>ObservaÃ§Ãµes:</strong> Ãrea mÃ­nima por peÃ§a: 0,25 mÂ². Espelhos sÃ£o calculados por mÂ².
                    Itens adicionados aparecerÃ£o na lista ao lado.
                </div>
            </section>

            <!-- Painel do OrÃ§amento Atual -->
            <aside class="card">
                <div style="display:flex;justify-content:space-between;align-items:center">
                    <h2 style="margin:0; color:var(--accent);">ğŸ“‹ OrÃ§amento Atual</h2>
                    <div class="right-actions">
                        <button class="ghost small" id="clearBudgetBtn">ğŸ—‘ï¸ Limpar Tudo</button>
                        <button class="btn small" id="viewBudgetBtn" disabled>ğŸ‘ï¸ Ver OrÃ§amento</button>
                    </div>
                </div>

                <div id="itemsList" style="margin-top:10px" class="list">
                    <div class="muted" style="text-align:center; padding:20px;">
                        ğŸ“ Nenhum item adicionado ao orÃ§amento...
                    </div>
                </div>

                <div style="margin-top:12px; display:flex;justify-content:space-between;align-items:center; padding:12px; background:#f0fdf4; border-radius:8px;">
                    <div style="font-weight:700; color:#166534;">ğŸ“Š Total de Itens</div>
                    <div class="tot" id="itemCount">0</div>
                </div>

                <hr style="margin:12px 0;border:none;border-top:1px solid #eef2f6">

                <h3 style="margin:0 0 8px 0; color:var(--accent);">ğŸ’¾ OrÃ§amentos Salvos</h3>

                <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
                    <input id="searchInput" placeholder="ğŸ” Buscar por nome, telefone ou data..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6eef8">
                    <button class="btn small" id="searchBtn">Buscar</button>
                </div>

                <div id="savedBudgets" style="max-height:36vh;overflow:auto">
                    <div class="muted" style="text-align:center; padding:15px;">
                        ğŸ’¾ Nenhum orÃ§amento salvo localmente...
                    </div>
                </div>
            </aside>
        </main>

        <footer>
            <div class="muted">
                ğŸš€ Desenvolvido para VidraÃ§aria da FamÃ­lia | 
                ğŸ’» Sistema Online com Banco de Dados |
                ğŸ“… VersÃ£o: 2.0 - Com Supabase
            </div>
        </footer>
    </div>

    <script src="config.js"></script>
    <script src="prices.js"></script>
    <script src="app.js"></script>
</body>
</html>